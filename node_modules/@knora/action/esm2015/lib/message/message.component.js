import { Component, Input } from '@angular/core';
import { Location } from '@angular/common';
import { ActivatedRoute, Router } from '@angular/router';
import defaultMsgs from '../../assets/i18n/statusMsg.json';
/**
 * @ignore
 * Data type for messages
 */
export class KuiMessageData {
}
/**
 * Message component to handle notes, warning and error messages.
 * If you set the paramater `[short]="true"` it shows a smaller message. It can be used to give feedbacks in a form e.g. update process: show success or error message.
 *
 */
export class MessageComponent {
    constructor(_router, _location, _activatedRoute) {
        this._router = _router;
        this._location = _location;
        this._activatedRoute = _activatedRoute;
        /**
         * Message type: KuiMessageData or ApiServiceError
         *
         * @param  {KuiMessageData | ApiServiceError} message This type needs at least a status number (0-511). In this case, or if type is ApiServiceError, it takes the default status messages from the list of HTTP status codes (https://en.wikipedia.org/wiki/List_of_HTTP_status_codes)
         */
        this.message = new KuiMessageData();
        /**
         * Show short message only
         *
         * @param  {boolean} [short]
         */
        this.short = false;
        this.isLoading = true;
        this.showLinks = false;
        // disable message
        this.disable = false;
        /*
         * @ignore
         * default link list, which will be used in message content to give a user some possibilities
         * what he can do in the case of an error
         *
         */
        this.links = {
            title: 'You have the following possibilities now',
            list: [
                {
                    label: 'go to the start page',
                    route: '/',
                    icon: 'keyboard_arrow_right'
                },
                {
                    label: 'try to login',
                    route: '/login',
                    icon: 'keyboard_arrow_right'
                },
                {
                    label: 'go back',
                    route: '<--',
                    icon: 'keyboard_arrow_left'
                }
            ]
        };
        this.footnote = {
            text: 'If you think it\'s a mistake, please',
            team: {
                knora: '<a href=\'https://github.com/dhlab-basel/knora\' target=\'_blank\'> inform the Knora team </a>',
                salsah: '<a href=\'https://github.com/dhlab-basel/salsah\' target=\'_blank\'> inform the Salsah developers </a>'
            }
        };
    }
    ngOnInit() {
        this.statusMsg = defaultMsgs;
        if (!this.message) {
            this._activatedRoute.data.subscribe((data) => {
                this.message.status = data.status;
            });
        }
        this.message = this.setMessage(this.message);
        this.isLoading = false;
    }
    setMessage(msg) {
        const tmpMsg = {};
        const s = msg.status === 0 ? 503 : msg.status;
        tmpMsg.status = s;
        tmpMsg.route = msg.route;
        tmpMsg.statusMsg = msg.statusMsg;
        tmpMsg.statusText = msg.statusText;
        tmpMsg.route = msg.route;
        tmpMsg.footnote = msg.footnote;
        switch (true) {
            case s > 0 && s < 300:
                // the message is a note
                tmpMsg.type = 'note';
                // console.log('the message is a note');
                break;
            case s >= 300 && s < 400:
                // the message is a warning
                tmpMsg.type = 'warning';
                // console.log('the message is a warning');
                break;
            case s >= 400 && s < 500:
                // the message is a client side (app) error
                // console.error('the message is a client side (app) error', s);
                tmpMsg.type = 'error';
                tmpMsg.statusMsg =
                    msg.statusMsg !== undefined
                        ? msg.statusMsg
                        : this.statusMsg[s].message;
                tmpMsg.statusText =
                    msg.statusText !== undefined
                        ? msg.statusText
                        : this.statusMsg[s].description;
                tmpMsg.footnote =
                    this.footnote.text + ' ' + this.footnote.team.knora;
                this.showLinks = true;
                break;
            case s >= 500 && s < 600:
                // the message is a server side (api) error
                // console.error('the message is a server side (api) error');
                tmpMsg.type = 'error';
                tmpMsg.statusMsg =
                    msg.statusMsg !== undefined
                        ? msg.statusMsg
                        : this.statusMsg[s].message;
                tmpMsg.statusText =
                    msg.statusText !== undefined
                        ? msg.statusText
                        : this.statusMsg[s].description;
                tmpMsg.footnote =
                    this.footnote.text + ' ' + this.footnote.team.knora;
                this.showLinks = false;
                break;
            default:
                // no default configuration?
                break;
        }
        return tmpMsg;
    }
    goToLocation(route) {
        if (route === '<--') {
            this._location.back();
        }
        else {
            this._router.navigate([route]);
        }
    }
    closeMessage() {
        this.disable = !this.disable;
    }
}
MessageComponent.decorators = [
    { type: Component, args: [{
                selector: 'kui-message',
                template: "<mat-card *ngIf=\"!short\" class=\"fix-width kui-message\" [ngClass]=\"'kui-' + message?.type\">\n\n  <mat-card-subtitle class=\"message-subtitle\">\n      <span class=\"left\">{{message?.type | uppercase }} {{message?.status}} | {{message?.statusMsg}}</span>\n      <mat-icon class=\"right\">{{message?.type}}</mat-icon>\n  </mat-card-subtitle>\n\n  <mat-card-title class=\"message-title\" [innerHtml]=\"message?.statusText\"></mat-card-title>\n\n  <mat-card-content class=\"message-content\">\n      <mat-list *ngIf=\"message?.route\">\n          <mat-list-item>\n              <a [href]=\"message?.route\" target=\"_blank\">\n                  &rarr; {{message?.route}}\n              </a>\n          </mat-list-item>\n      </mat-list>\n\n      <mat-list *ngIf=\"showLinks\">\n          <p>{{links.title}}</p>\n          <mat-list-item *ngFor=\"let item of links.list\" class=\"link\" (click)=\"goToLocation(item.route)\">\n              <mat-icon mat-list-icon>{{item.icon}}</mat-icon>\n              <p mat-line>{{item.label}}</p>\n          </mat-list-item>\n      </mat-list>\n\n\n\n  </mat-card-content>\n\n  <mat-card-footer class=\"message-footnote\" [innerHtml]=\"message?.footnote\"></mat-card-footer>\n\n</mat-card>\n\n\n<mat-card *ngIf=\"short && !disable\" class=\"fix-width kui-short-message\" [ngClass]=\"'kui-' + message?.type\">\n\n  <div class=\"kui-panel\">\n      <span class=\"kui-short-message-text\">\n          {{message?.statusText}}\n      </span>\n      <span class=\"fill-remaining-space\"></span>\n      <button mat-icon-button (click)=\"closeMessage()\">\n          <mat-icon>close</mat-icon>\n      </button>\n  </div>\n\n</mat-card>",
                styles: [".kui-panel{display:flex;box-sizing:border-box;flex-direction:row;white-space:nowrap}.fill-remaining-space{flex-basis:auto;flex-grow:1;flex-shrink:1}.kui-error{background-color:rgba(244,67,54,.5)}.kui-warning{background-color:rgba(255,196,0,.5)}.kui-hint,.kui-note{background-color:rgba(0,105,92,.4)}.kui-error,.kui-hint,.kui-note,.kui-warning{margin:12px auto;max-width:640px}.kui-error .message-subtitle,.kui-hint .message-subtitle,.kui-note .message-subtitle,.kui-warning .message-subtitle{padding-bottom:12px}.kui-error .message-subtitle .left,.kui-hint .message-subtitle .left,.kui-note .message-subtitle .left,.kui-warning .message-subtitle .left{float:left;left:16px;position:absolute;text-align:left}.kui-error .message-subtitle .right,.kui-hint .message-subtitle .right,.kui-note .message-subtitle .right,.kui-warning .message-subtitle .right{float:right;right:16px;position:absolute;text-align:right}.kui-error .message-title,.kui-hint .message-title,.kui-note .message-title,.kui-warning .message-title{padding-top:12px}.kui-error .message-content,.kui-hint .message-content,.kui-note .message-content,.kui-warning .message-content{margin-bottom:48px;margin-top:48px}.kui-error .message-content .link,.kui-hint .message-content .link,.kui-note .message-content .link,.kui-warning .message-content .link{cursor:pointer}.kui-error .message-footnote,.kui-hint .message-footnote,.kui-note .message-footnote,.kui-warning .message-footnote{padding:24px}.kui-short-message .kui-short-message-text{font-weight:bolder;text-align:center}"]
            }] }
];
/** @nocollapse */
MessageComponent.ctorParameters = () => [
    { type: Router },
    { type: Location },
    { type: ActivatedRoute }
];
MessageComponent.propDecorators = {
    message: [{ type: Input }],
    short: [{ type: Input }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVzc2FnZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9Aa25vcmEvYWN0aW9uLyIsInNvdXJjZXMiOlsibGliL21lc3NhZ2UvbWVzc2FnZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQVUsTUFBTSxlQUFlLENBQUM7QUFDekQsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFFekQsT0FBTyxXQUFXLE1BQU0sa0NBQWtDLENBQUM7QUFFM0Q7OztHQUdHO0FBQ0gsTUFBTSxPQUFPLGNBQWM7Q0FTMUI7QUFFRDs7OztHQUlHO0FBTUgsTUFBTSxPQUFPLGdCQUFnQjtJQWdFekIsWUFDWSxPQUFlLEVBQ2YsU0FBbUIsRUFDbkIsZUFBK0I7UUFGL0IsWUFBTyxHQUFQLE9BQU8sQ0FBUTtRQUNmLGNBQVMsR0FBVCxTQUFTLENBQVU7UUFDbkIsb0JBQWUsR0FBZixlQUFlLENBQWdCO1FBbEUzQzs7OztXQUlHO1FBQ00sWUFBTyxHQUFtQixJQUFJLGNBQWMsRUFBRSxDQUFDO1FBRXhEOzs7O1dBSUc7UUFDTSxVQUFLLEdBQWEsS0FBSyxDQUFDO1FBT2pDLGNBQVMsR0FBWSxJQUFJLENBQUM7UUFFMUIsY0FBUyxHQUFZLEtBQUssQ0FBQztRQUUzQixrQkFBa0I7UUFDbEIsWUFBTyxHQUFZLEtBQUssQ0FBQztRQUV6Qjs7Ozs7V0FLRztRQUNILFVBQUssR0FBUTtZQUNULEtBQUssRUFBRSwwQ0FBMEM7WUFDakQsSUFBSSxFQUFFO2dCQUNGO29CQUNJLEtBQUssRUFBRSxzQkFBc0I7b0JBQzdCLEtBQUssRUFBRSxHQUFHO29CQUNWLElBQUksRUFBRSxzQkFBc0I7aUJBQy9CO2dCQUNEO29CQUNJLEtBQUssRUFBRSxjQUFjO29CQUNyQixLQUFLLEVBQUUsUUFBUTtv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Q0FBQztJQUNqQyxDQUFDOzs7WUFwS0osU0FBUyxTQUFDO2dCQUNQLFFBQVEsRUFBRSxhQUFhO2dCQUN2Qiwrb0RBQXVDOzthQUUxQzs7OztZQTVCd0IsTUFBTTtZQUR0QixRQUFRO1lBQ1IsY0FBYzs7O3NCQW1DbEIsS0FBSztvQkFPTCxLQUFLIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgT25Jbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBMb2NhdGlvbiB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQgeyBBY3RpdmF0ZWRSb3V0ZSwgUm91dGVyIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcblxuaW1wb3J0IGRlZmF1bHRNc2dzIGZyb20gJy4uLy4uL2Fzc2V0cy9pMThuL3N0YXR1c01zZy5qc29uJztcblxuLyoqXG4gKiBAaWdub3JlXG4gKiBEYXRhIHR5cGUgZm9yIG1lc3NhZ2VzXG4gKi9cbmV4cG9ydCBjbGFzcyBLdWlNZXNzYWdlRGF0YSB7XG4gICAgc3RhdHVzOiBudW1iZXI7XG4gICAgc3RhdHVzTXNnPzogc3RyaW5nO1xuICAgIHN0YXR1c1RleHQ/OiBzdHJpbmc7XG4gICAgdHlwZT86IHN0cmluZztcbiAgICByb3V0ZT86IHN0cmluZztcbiAgICBmb290bm90ZT86IHN0cmluZztcbiAgICBlcnJvckluZm8/OiBzdHJpbmc7XG4gICAgdXJsPzogc3RyaW5nO1xufVxuXG4vKipcbiAqIE1lc3NhZ2UgY29tcG9uZW50IHRvIGhhbmRsZSBub3Rlcywgd2FybmluZyBhbmQgZXJyb3IgbWVzc2FnZXMuXG4gKiBJZiB5b3Ugc2V0IHRoZSBwYXJhbWF0ZXIgYFtzaG9ydF09XCJ0cnVlXCJgIGl0IHNob3dzIGEgc21hbGxlciBtZXNzYWdlLiBJdCBjYW4gYmUgdXNlZCB0byBnaXZlIGZlZWRiYWNrcyBpbiBhIGZvcm0gZS5nLiB1cGRhdGUgcHJvY2Vzczogc2hvdyBzdWNjZXNzIG9yIGVycm9yIG1lc3NhZ2UuXG4gKlxuICovXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ2t1aS1tZXNzYWdlJyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vbWVzc2FnZS5jb21wb25lbnQuaHRtbCcsXG4gICAgc3R5bGVVcmxzOiBbJy4vbWVzc2FnZS5jb21wb25lbnQuc2NzcyddXG59KVxuZXhwb3J0IGNsYXNzIE1lc3NhZ2VDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICAgIC8qKlxuICAgICAqIE1lc3NhZ2UgdHlwZTogS3VpTWVzc2FnZURhdGEgb3IgQXBpU2VydmljZUVycm9yXG4gICAgICpcbiAgICAgKiBAcGFyYW0gIHtLdWlNZXNzYWdlRGF0YSB8IEFwaVNlcnZpY2VFcnJvcn0gbWVzc2FnZSBUaGlzIHR5cGUgbmVlZHMgYXQgbGVhc3QgYSBzdGF0dXMgbnVtYmVyICgwLTUxMSkuIEluIHRoaXMgY2FzZSwgb3IgaWYgdHlwZSBpcyBBcGlTZXJ2aWNlRXJyb3IsIGl0IHRha2VzIHRoZSBkZWZhdWx0IHN0YXR1cyBtZXNzYWdlcyBmcm9tIHRoZSBsaXN0IG9mIEhUVFAgc3RhdHVzIGNvZGVzIChodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9MaXN0X29mX0hUVFBfc3RhdHVzX2NvZGVzKVxuICAgICAqL1xuICAgIEBJbnB1dCgpIG1lc3NhZ2U6IEt1aU1lc3NhZ2VEYXRhID0gbmV3IEt1aU1lc3NhZ2VEYXRhKCk7XG5cbiAgICAvKipcbiAgICAgKiBTaG93IHNob3J0IG1lc3NhZ2Ugb25seVxuICAgICAqXG4gICAgICogQHBhcmFtICB7Ym9vbGVhbn0gW3Nob3J0XVxuICAgICAqL1xuICAgIEBJbnB1dCgpIHNob3J0PzogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgLy8gICAgbWVzc2FnZTogTWVzc2FnZURhdGE7XG5cbiAgICAvLyBzdGF0dXNNc2c6IGFueSA9IGRlZmF1bHRNc2dzO1xuICAgIHN0YXR1c01zZzogYW55O1xuXG4gICAgaXNMb2FkaW5nOiBib29sZWFuID0gdHJ1ZTtcblxuICAgIHNob3dMaW5rczogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgLy8gZGlzYWJsZSBtZXNzYWdlXG4gICAgZGlzYWJsZTogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgLypcbiAgICAgKiBAaWdub3JlXG4gICAgICogZGVmYXVsdCBsaW5rIGxpc3QsIHdoaWNoIHdpbGwgYmUgdXNlZCBpbiBtZXNzYWdlIGNvbnRlbnQgdG8gZ2l2ZSBhIHVzZXIgc29tZSBwb3NzaWJpbGl0aWVzXG4gICAgICogd2hhdCBoZSBjYW4gZG8gaW4gdGhlIGNhc2Ugb2YgYW4gZXJyb3JcbiAgICAgKlxuICAgICAqL1xuICAgIGxpbmtzOiBhbnkgPSB7XG4gICAgICAgIHRpdGxlOiAnWW91IGhhdmUgdGhlIGZvbGxvd2luZyBwb3NzaWJpbGl0aWVzIG5vdycsXG4gICAgICAgIGxpc3Q6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBsYWJlbDogJ2dvIHRvIHRoZSBzdGFydCBwYWdlJyxcbiAgICAgICAgICAgICAgICByb3V0ZTogJy8nLFxuICAgICAgICAgICAgICAgIGljb246ICdrZXlib2FyZF9hcnJvd19yaWdodCdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbGFiZWw6ICd0cnkgdG8gbG9naW4nLFxuICAgICAgICAgICAgICAgIHJvdXRlOiAnL2xvZ2luJyxcbiAgICAgICAgICAgICAgICBpY29uOiAna2V5Ym9hcmRfYXJyb3dfcmlnaHQnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGxhYmVsOiAnZ28gYmFjaycsXG4gICAgICAgICAgICAgICAgcm91dGU6ICc8LS0nLFxuICAgICAgICAgICAgICAgIGljb246ICdrZXlib2FyZF9hcnJvd19sZWZ0J1xuICAgICAgICAgICAgfVxuICAgICAgICBdXG4gICAgfTtcblxuICAgIGZvb3Rub3RlOiBhbnkgPSB7XG4gICAgICAgIHRleHQ6ICdJZiB5b3UgdGhpbmsgaXRcXCdzIGEgbWlzdGFrZSwgcGxlYXNlJyxcbiAgICAgICAgdGVhbToge1xuICAgICAgICAgICAga25vcmE6XG4gICAgICAgICAgICAgICAgJzxhIGhyZWY9XFwnaHR0cHM6Ly9naXRodWIuY29tL2RobGFiLWJhc2VsL2tub3JhXFwnIHRhcmdldD1cXCdfYmxhbmtcXCc+IGluZm9ybSB0aGUgS25vcmEgdGVhbSA8L2E+JyxcbiAgICAgICAgICAgIHNhbHNhaDpcbiAgICAgICAgICAgICAgICAnPGEgaHJlZj1cXCdodHRwczovL2dpdGh1Yi5jb20vZGhsYWItYmFzZWwvc2Fsc2FoXFwnIHRhcmdldD1cXCdfYmxhbmtcXCc+IGluZm9ybSB0aGUgU2Fsc2FoIGRldmVsb3BlcnMgPC9hPidcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcHJpdmF0ZSBfcm91dGVyOiBSb3V0ZXIsXG4gICAgICAgIHByaXZhdGUgX2xvY2F0aW9uOiBMb2NhdGlvbixcbiAgICAgICAgcHJpdmF0ZSBfYWN0aXZhdGVkUm91dGU6IEFjdGl2YXRlZFJvdXRlXG4gICAgKSB7fVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMuc3RhdHVzTXNnID0gZGVmYXVsdE1zZ3M7XG5cbiAgICAgICAgaWYgKCF0aGlzLm1lc3NhZ2UpIHtcbiAgICAgICAgICAgIHRoaXMuX2FjdGl2YXRlZFJvdXRlLmRhdGEuc3Vic2NyaWJlKChkYXRhOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLm1lc3NhZ2Uuc3RhdHVzID0gZGF0YS5zdGF0dXM7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMubWVzc2FnZSA9IHRoaXMuc2V0TWVzc2FnZSh0aGlzLm1lc3NhZ2UpO1xuICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlO1xuXG4gICAgfVxuXG4gICAgc2V0TWVzc2FnZShtc2c6IEt1aU1lc3NhZ2VEYXRhKSB7XG4gICAgICAgIGNvbnN0IHRtcE1zZzogS3VpTWVzc2FnZURhdGEgPSA8S3VpTWVzc2FnZURhdGE+e307XG5cbiAgICAgICAgY29uc3QgczogbnVtYmVyID0gbXNnLnN0YXR1cyA9PT0gMCA/IDUwMyA6IG1zZy5zdGF0dXM7XG5cbiAgICAgICAgdG1wTXNnLnN0YXR1cyA9IHM7XG4gICAgICAgIHRtcE1zZy5yb3V0ZSA9IG1zZy5yb3V0ZTtcbiAgICAgICAgdG1wTXNnLnN0YXR1c01zZyA9IG1zZy5zdGF0dXNNc2c7XG4gICAgICAgIHRtcE1zZy5zdGF0dXNUZXh0ID0gbXNnLnN0YXR1c1RleHQ7XG4gICAgICAgIHRtcE1zZy5yb3V0ZSA9IG1zZy5yb3V0ZTtcbiAgICAgICAgdG1wTXNnLmZvb3Rub3RlID0gbXNnLmZvb3Rub3RlO1xuXG4gICAgICAgIHN3aXRjaCAodHJ1ZSkge1xuICAgICAgICAgICAgY2FzZSBzID4gMCAmJiBzIDwgMzAwOlxuICAgICAgICAgICAgICAgIC8vIHRoZSBtZXNzYWdlIGlzIGEgbm90ZVxuICAgICAgICAgICAgICAgIHRtcE1zZy50eXBlID0gJ25vdGUnO1xuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCd0aGUgbWVzc2FnZSBpcyBhIG5vdGUnKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgcyA+PSAzMDAgJiYgcyA8IDQwMDpcbiAgICAgICAgICAgICAgICAvLyB0aGUgbWVzc2FnZSBpcyBhIHdhcm5pbmdcbiAgICAgICAgICAgICAgICB0bXBNc2cudHlwZSA9ICd3YXJuaW5nJztcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygndGhlIG1lc3NhZ2UgaXMgYSB3YXJuaW5nJyk7XG5cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgcyA+PSA0MDAgJiYgcyA8IDUwMDpcbiAgICAgICAgICAgICAgICAvLyB0aGUgbWVzc2FnZSBpcyBhIGNsaWVudCBzaWRlIChhcHApIGVycm9yXG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5lcnJvcigndGhlIG1lc3NhZ2UgaXMgYSBjbGllbnQgc2lkZSAoYXBwKSBlcnJvcicsIHMpO1xuICAgICAgICAgICAgICAgIHRtcE1zZy50eXBlID0gJ2Vycm9yJztcbiAgICAgICAgICAgICAgICB0bXBNc2cuc3RhdHVzTXNnID1cbiAgICAgICAgICAgICAgICAgICAgbXNnLnN0YXR1c01zZyAhPT0gdW5kZWZpbmVkXG4gICAgICAgICAgICAgICAgICAgICAgICA/IG1zZy5zdGF0dXNNc2dcbiAgICAgICAgICAgICAgICAgICAgICAgIDogdGhpcy5zdGF0dXNNc2dbc10ubWVzc2FnZTtcbiAgICAgICAgICAgICAgICB0bXBNc2cuc3RhdHVzVGV4dCA9XG4gICAgICAgICAgICAgICAgICAgIG1zZy5zdGF0dXNUZXh0ICE9PSB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICAgICAgICAgID8gbXNnLnN0YXR1c1RleHRcbiAgICAgICAgICAgICAgICAgICAgICAgIDogdGhpcy5zdGF0dXNNc2dbc10uZGVzY3JpcHRpb247XG4gICAgICAgICAgICAgICAgdG1wTXNnLmZvb3Rub3RlID1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mb290bm90ZS50ZXh0ICsgJyAnICsgdGhpcy5mb290bm90ZS50ZWFtLmtub3JhO1xuICAgICAgICAgICAgICAgIHRoaXMuc2hvd0xpbmtzID0gdHJ1ZTtcblxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBzID49IDUwMCAmJiBzIDwgNjAwOlxuICAgICAgICAgICAgICAgIC8vIHRoZSBtZXNzYWdlIGlzIGEgc2VydmVyIHNpZGUgKGFwaSkgZXJyb3JcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmVycm9yKCd0aGUgbWVzc2FnZSBpcyBhIHNlcnZlciBzaWRlIChhcGkpIGVycm9yJyk7XG4gICAgICAgICAgICAgICAgdG1wTXNnLnR5cGUgPSAnZXJyb3InO1xuICAgICAgICAgICAgICAgIHRtcE1zZy5zdGF0dXNNc2cgPVxuICAgICAgICAgICAgICAgICAgICBtc2cuc3RhdHVzTXNnICE9PSB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICAgICAgICAgID8gbXNnLnN0YXR1c01zZ1xuICAgICAgICAgICAgICAgICAgICAgICAgOiB0aGlzLnN0YXR1c01zZ1tzXS5tZXNzYWdlO1xuICAgICAgICAgICAgICAgIHRtcE1zZy5zdGF0dXNUZXh0ID1cbiAgICAgICAgICAgICAgICAgICAgbXNnLnN0YXR1c1RleHQgIT09IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgICAgICAgICAgPyBtc2cuc3RhdHVzVGV4dFxuICAgICAgICAgICAgICAgICAgICAgICAgOiB0aGlzLnN0YXR1c01zZ1tzXS5kZXNjcmlwdGlvbjtcbiAgICAgICAgICAgICAgICB0bXBNc2cuZm9vdG5vdGUgPVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmZvb3Rub3RlLnRleHQgKyAnICcgKyB0aGlzLmZvb3Rub3RlLnRlYW0ua25vcmE7XG4gICAgICAgICAgICAgICAgdGhpcy5zaG93TGlua3MgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgLy8gbm8gZGVmYXVsdCBjb25maWd1cmF0aW9uP1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRtcE1zZztcbiAgICB9XG5cbiAgICBnb1RvTG9jYXRpb24ocm91dGU6IHN0cmluZykge1xuICAgICAgICBpZiAocm91dGUgPT09ICc8LS0nKSB7XG4gICAgICAgICAgICB0aGlzLl9sb2NhdGlvbi5iYWNrKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9yb3V0ZXIubmF2aWdhdGUoW3JvdXRlXSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjbG9zZU1lc3NhZ2UoKSB7XG4gICAgICAgIHRoaXMuZGlzYWJsZSA9ICF0aGlzLmRpc2FibGU7XG4gICAgfVxufVxuIl19
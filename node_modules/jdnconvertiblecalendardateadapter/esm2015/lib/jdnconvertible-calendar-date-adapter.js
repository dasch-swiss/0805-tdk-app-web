/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*
 * Copyright © 2017 Lukas Rosenthaler, Benjamin Geer, Ivan Subotic,
 * Tobias Schweizer, André Kilchenmann, and Sepideh Alassi.
 *
 * This file is part of JDNConvertibleCalendarDateAdapter.
 *
 * JDNConvertibleCalendarDateAdapter is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published
 * by the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * JDNConvertibleCalendarDateAdapter is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public
 * License along with JDNConvertibleCalendarDateAdapter.  If not, see <http://www.gnu.org/licenses/>.
 */
import { Injectable } from '@angular/core';
import { DateAdapter } from '@angular/material';
import { CalendarDate, CalendarPeriod, GregorianCalendarDate, JDNConvertibleCalendar, JulianCalendarDate } from 'jdnconvertiblecalendar';
/**
 * Implements `DateAdapter` for `JDNConvertibleCalendar`.
 *
 * `JDNConvertibleCalendar` supports periods (dates with different precisions), but here only exact days are supported for now.
 */
export class JDNConvertibleCalendarDateAdapter extends DateAdapter {
    constructor() {
        super(...arguments);
        // the currently active calendar format
        this._activeCalendarFormat = 'Gregorian';
    }
    /**
     * @return {?}
     */
    get activeCalendarFormat() {
        return this._activeCalendarFormat;
    }
    /**
     * Adds leading zeros to a given number and returns the resulting string.
     *
     * @private
     * @param {?} num the given number.
     * @param {?} digits the number of expected digits.
     * @return {?} string containing leading zeros.
     */
    static addLeadingZeroToNumber(num, digits) {
        /** @type {?} */
        const missingDigits = digits - String(num).length;
        if (missingDigits > 0) {
            /** @type {?} */
            let leadingZeros = '';
            for (let i = 0; i < missingDigits; i++) {
                leadingZeros += '0';
            }
            return `${leadingZeros}${num}`;
        }
        else {
            return String(num);
        }
    }
    /**
     * Converts the given date to the indicated calendar format.
     *
     * @param {?} date the date to be converted.
     * @param {?} format the calendar format to convert to.
     * @return {?} converted date.
     */
    convertCalendarFormat(date, format) {
        // another instance has to be returned, otherwise "activeDate" set method is not triggered for MatYearView
        // another instance has to be returned, otherwise "activeDate" set method is not triggered for MatYearView
        /** @type {?} */
        const dateMod = this.clone(date);
        switch (format) {
            case 'Gregorian':
                this._activeCalendarFormat = 'Gregorian';
                return dateMod.convertCalendar('Gregorian');
            case 'Julian':
                this._activeCalendarFormat = 'Julian';
                return dateMod.convertCalendar('Julian');
            default:
                // invalid format
                return dateMod;
        }
    }
    /**
     * @param {?} date
     * @return {?}
     */
    getYear(date) {
        return date.toCalendarPeriod().periodStart.year;
    }
    /**
     * @param {?} date
     * @return {?}
     */
    getMonth(date) {
        // return 0 index based month
        return date.toCalendarPeriod().periodStart.month - 1;
    }
    /**
     * @param {?} date
     * @return {?}
     */
    getDate(date) {
        return date.toCalendarPeriod().periodStart.day;
    }
    /**
     * @param {?} date
     * @return {?}
     */
    getDayOfWeek(date) {
        // dayOfWeek is an optional class member, but always set when returned by this method
        /** @type {?} */
        const dayOfWeek = date.toCalendarPeriod().periodStart.dayOfWeek;
        if (dayOfWeek !== undefined) {
            return dayOfWeek;
        }
        else {
            throw new Error('day of week is not set although it should be');
        }
    }
    /**
     * @param {?} style
     * @return {?}
     */
    getMonthNames(style) {
        // TODO: implement this properly, taking calendar format and locale into account
        return ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'June', 'July', 'Aug', 'Sept', 'Oct', 'Nov', 'Dec'];
    }
    /**
     * @return {?}
     */
    getDateNames() {
        // TODO: implement this properly, taking calendar format and locale into account
        /** @type {?} */
        const dateNames = [];
        for (let i = 1; i <= 31; i++) {
            dateNames.push(String(i));
        }
        return dateNames;
    }
    /**
     * @param {?} style
     * @return {?}
     */
    getDayOfWeekNames(style) {
        // TODO: implement this properly, taking calendar format and locale into account
        return ['Sun', 'Mon', 'Tue', 'Wed', 'Thur', 'Fri', 'Sat'];
    }
    /**
     * @param {?} date
     * @return {?}
     */
    getYearName(date) {
        return String(date.toCalendarPeriod().periodStart.year);
    }
    /**
     * @return {?}
     */
    getFirstDayOfWeek() {
        // TODO: implement this properly, taking calendar format into account
        return 0;
    }
    /**
     * @param {?} date
     * @return {?}
     */
    getNumDaysInMonth(date) {
        /** @type {?} */
        const calendarPeriod = date.toCalendarPeriod();
        return date.daysInMonth(calendarPeriod.periodStart);
    }
    /**
     * @param {?} date
     * @return {?}
     */
    clone(date) {
        /** @type {?} */
        const jdnPeriod = date.toJDNPeriod();
        switch (this._activeCalendarFormat) {
            case 'Gregorian':
                return new GregorianCalendarDate(jdnPeriod);
            case 'Julian':
                return new JulianCalendarDate(jdnPeriod);
        }
    }
    /**
     * Creates a date in the specified calendar format.
     *
     * @private
     * @param {?} year the date's year.
     * @param {?} month the date's month (0-based index).
     * @param {?} date the date's day.
     * @param {?} calendar the calendar format to be used.
     * @return {?} a date in the specified calendar format.
     */
    createCalendarDate(year, month, date, calendar) {
        // month param is 0 indexed, but we use 1 based index for months
        /** @type {?} */
        const calDate = new CalendarDate(year, month + 1, date);
        switch (calendar) {
            case 'Gregorian':
                return new GregorianCalendarDate(new CalendarPeriod(calDate, calDate));
            case 'Julian':
                return new JulianCalendarDate(new CalendarPeriod(calDate, calDate));
        }
    }
    /**
     * @param {?} year
     * @param {?} month
     * @param {?} date
     * @return {?}
     */
    createDate(year, month, date) {
        // create a date in the active calendar format
        return this.createCalendarDate(year, month, date, this._activeCalendarFormat);
    }
    /**
     * @return {?}
     */
    today() {
        // get today's date from the native JS Date object
        /** @type {?} */
        const today = new Date();
        /** @type {?} */
        const year = today.getFullYear();
        // 0 based month
        /** @type {?} */
        const month = today.getMonth();
        // day of month, 1 based index
        /** @type {?} */
        const day = today.getDate();
        // create a Gregorian calendar date from the native JS object
        // month used a 1 based index
        /** @type {?} */
        const calDate = new CalendarDate(year, month + 1, day);
        /** @type {?} */
        const dateGregorian = new GregorianCalendarDate(new CalendarPeriod(calDate, calDate));
        // convert the date to the active calendar format
        /** @type {?} */
        const date = this.convertCalendarFormat(dateGregorian, this._activeCalendarFormat);
        return date;
    }
    /**
     * @param {?} value
     * @param {?} parseFormat
     * @return {?}
     */
    parse(value, parseFormat) {
        /** @type {?} */
        let date;
        if (parseFormat !== undefined && typeof parseFormat === 'string' && JDNConvertibleCalendarDateAdapter.parsableDateFormats.indexOf(parseFormat) !== -1) {
            switch (parseFormat) {
                case JDNConvertibleCalendarDateAdapter.DD_MM_YYYY: {
                    /** @type {?} */
                    const dateStringRegex = JDNConvertibleCalendarDateAdapter.dateFormatRegexes[parseFormat];
                    /** @type {?} */
                    const parsed = dateStringRegex.exec(value);
                    if (parsed !== null) {
                        // index 0 is the whole match
                        // month index must be 0 based
                        date = this.createDate(parseInt(parsed[3]), parseInt(parsed[2]) - 1, parseInt(parsed[1]));
                        break;
                    }
                    else {
                        console.log(`Error: parsing of date string failed: ${value}`);
                        return null;
                    }
                }
                default: {
                    console.log(`Error: supported parsable format was not handled correctly: ${parseFormat}`);
                    return null;
                }
            }
        }
        else {
            console.log(`Error: unknown parseFormat ${parseFormat}`);
            return null;
        }
        return date;
    }
    /**
     * @param {?} date
     * @param {?} displayFormat
     * @return {?}
     */
    format(date, displayFormat) {
        /** @type {?} */
        let dateString = '';
        if (displayFormat !== undefined && typeof displayFormat === 'string' && JDNConvertibleCalendarDateAdapter.displayDateFormats.lastIndexOf(displayFormat) !== -1) {
            /** @type {?} */
            const calendarPeriod = date.toCalendarPeriod();
            switch (displayFormat) {
                case JDNConvertibleCalendarDateAdapter.DD_MM_YYYY: {
                    dateString =
                        `${JDNConvertibleCalendarDateAdapter.addLeadingZeroToNumber(calendarPeriod.periodStart.day, 2)}-${JDNConvertibleCalendarDateAdapter.addLeadingZeroToNumber(calendarPeriod.periodStart.month, 2)}-${JDNConvertibleCalendarDateAdapter.addLeadingZeroToNumber(calendarPeriod.periodStart.year, 4)}`;
                    break;
                }
                case JDNConvertibleCalendarDateAdapter.MM_YYYY: {
                    dateString = `${JDNConvertibleCalendarDateAdapter.addLeadingZeroToNumber(calendarPeriod.periodStart.month, 2)}-${JDNConvertibleCalendarDateAdapter.addLeadingZeroToNumber(calendarPeriod.periodStart.year, 4)}`;
                    break;
                }
                default: {
                    console.log(`Error: supported display format was not handled correctly: ${displayFormat}`);
                }
            }
        }
        else {
            console.log(`Error: unknown displayFormat ${displayFormat}`);
        }
        return dateString;
    }
    /**
     * @param {?} date
     * @param {?} years
     * @return {?}
     */
    addCalendarYears(date, years) {
        // another instance has to be returned, otherwise "activeDate" set method is not triggered for MatYearView
        // another instance has to be returned, otherwise "activeDate" set method is not triggered for MatYearView
        /** @type {?} */
        const dateMod = this.clone(date);
        dateMod.transposePeriodByYear(years);
        return dateMod;
    }
    /**
     * @param {?} date
     * @param {?} months
     * @return {?}
     */
    addCalendarMonths(date, months) {
        // another instance has to be returned, otherwise "activeDate" set method is not triggered for MatMonthView
        // another instance has to be returned, otherwise "activeDate" set method is not triggered for MatMonthView
        /** @type {?} */
        const dateMod = this.clone(date);
        dateMod.transposePeriodByMonth(months);
        return dateMod;
    }
    /**
     * @param {?} date
     * @param {?} days
     * @return {?}
     */
    addCalendarDays(date, days) {
        // another instance has to be returned, otherwise events do not work correctly
        // another instance has to be returned, otherwise events do not work correctly
        /** @type {?} */
        const dateMod = this.clone(date);
        dateMod.transposePeriodByDay(days);
        return dateMod;
    }
    /**
     * @param {?} date
     * @return {?}
     */
    toIso8601(date) {
        // use Gregorian
        /** @type {?} */
        const gregorianCal = date.convertCalendar('Gregorian');
        /** @type {?} */
        const gregorianCalPeriod = gregorianCal.toCalendarPeriod();
        console.log('to iso');
        return `${JDNConvertibleCalendarDateAdapter.addLeadingZeroToNumber(gregorianCalPeriod.periodStart.year, 4)}-${JDNConvertibleCalendarDateAdapter.addLeadingZeroToNumber(gregorianCalPeriod.periodStart.month, 2)}-${JDNConvertibleCalendarDateAdapter.addLeadingZeroToNumber(gregorianCalPeriod.periodStart.day, 2)}`;
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    isDateInstance(obj) {
        return (obj instanceof JDNConvertibleCalendar);
    }
    /**
     * @param {?} date
     * @return {?}
     */
    isValid(date) {
        // TODO: implement this properly
        return true;
    }
    /**
     * @return {?}
     */
    invalid() {
        // TODO: create an invalid instance? For testing?
        return this.today();
    }
}
JDNConvertibleCalendarDateAdapter.DD_MM_YYYY = 'DD-MM-YYYY';
JDNConvertibleCalendarDateAdapter.MM_YYYY = 'MM-YYYY';
JDNConvertibleCalendarDateAdapter.displayDateFormats = [JDNConvertibleCalendarDateAdapter.DD_MM_YYYY, JDNConvertibleCalendarDateAdapter.MM_YYYY];
JDNConvertibleCalendarDateAdapter.parsableDateFormats = [JDNConvertibleCalendarDateAdapter.DD_MM_YYYY];
JDNConvertibleCalendarDateAdapter.dateFormatRegexes = {
    'DD-MM-YYYY': new RegExp('^(\\d?\\d)-(\\d?\\d)-(\\d{4})')
};
JDNConvertibleCalendarDateAdapter.decorators = [
    { type: Injectable }
];
if (false) {
    /**
     * @type {?}
     * @private
     */
    JDNConvertibleCalendarDateAdapter.DD_MM_YYYY;
    /**
     * @type {?}
     * @private
     */
    JDNConvertibleCalendarDateAdapter.MM_YYYY;
    /**
     * @type {?}
     * @private
     */
    JDNConvertibleCalendarDateAdapter.displayDateFormats;
    /**
     * @type {?}
     * @private
     */
    JDNConvertibleCalendarDateAdapter.parsableDateFormats;
    /**
     * @type {?}
     * @private
     */
    JDNConvertibleCalendarDateAdapter.dateFormatRegexes;
    /**
     * @type {?}
     * @private
     */
    JDNConvertibleCalendarDateAdapter.prototype._activeCalendarFormat;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiamRuY29udmVydGlibGUtY2FsZW5kYXItZGF0ZS1hZGFwdGVyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vamRuY29udmVydGlibGVjYWxlbmRhcmRhdGVhZGFwdGVyLyIsInNvdXJjZXMiOlsibGliL2pkbmNvbnZlcnRpYmxlLWNhbGVuZGFyLWRhdGUtYWRhcHRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW9CQSxPQUFPLEVBQUMsVUFBVSxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBQ3pDLE9BQU8sRUFBQyxXQUFXLEVBQUMsTUFBTSxtQkFBbUIsQ0FBQztBQUM5QyxPQUFPLEVBQ0wsWUFBWSxFQUNaLGNBQWMsRUFDZCxxQkFBcUIsRUFDckIsc0JBQXNCLEVBR3RCLGtCQUFrQixFQUNuQixNQUFNLHdCQUF3QixDQUFDO0FBSWhDOzs7O0dBSUc7QUFDSCxNQUFNLE9BQU8saUNBQWtDLFNBQVEsV0FBbUM7SUFOMUY7OztRQXFCVSwwQkFBcUIsR0FBRyxXQUFXLENBQUM7SUF3VTlDLENBQUM7Ozs7SUF0VUMsSUFBSSxvQkFBb0I7UUFDdEIsT0FBTyxJQUFJLENBQUMscUJBQXFCLENBQUM7SUFDcEMsQ0FBQzs7Ozs7Ozs7O0lBU08sTUFBTSxDQUFDLHNCQUFzQixDQUFDLEdBQVcsRUFBRSxNQUFjOztjQUV6RCxhQUFhLEdBQUcsTUFBTSxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNO1FBRWpELElBQUksYUFBYSxHQUFHLENBQUMsRUFBRTs7Z0JBQ2pCLFlBQVksR0FBRyxFQUFFO1lBQ3JCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxhQUFhLEVBQUUsQ0FBQyxFQUFFLEVBQUU7Z0JBQ3RDLFlBQVksSUFBSSxHQUFHLENBQUM7YUFDckI7WUFFRCxPQUFPLEdBQUcsWUFBWSxHQUFHLEdBQUcsRUFBRSxDQUFDO1NBRWhDO2FBQU07WUFDTCxPQUFPLE1BQU0sQ0FBQyxHQUFHLENB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LENBQUM7UUFFdEIsT0FBTyxHQUFHLGlDQUFpQyxDQUFDLHNCQUFzQixDQUFDLGtCQUFrQixDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLElBQUksaUNBQWlDLENBQUMsc0JBQXNCLENBQUMsa0JBQWtCLENBQUMsV0FBVyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsSUFBSSxpQ0FBaUMsQ0FBQyxzQkFBc0IsQ0FBQyxrQkFBa0IsQ0FBQyxXQUFXLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUM7SUFFdlQsQ0FBQzs7Ozs7SUFHRCxjQUFjLENBQUMsR0FBUTtRQUNyQixPQUFPLENBQUMsR0FBRyxZQUFZLHNCQUFzQixDQUFDLENBQUM7SUFDakQsQ0FBQzs7Ozs7SUFFRCxPQUFPLENBQUMsSUFBNEI7UUFDbEMsZ0NBQWdDO1FBRWhDLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQzs7OztJQUVELE9BQU87UUFDTCxpREFBaUQ7UUFFakQsT0FBTyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDdEIsQ0FBQzs7QUFsVnVCLDRDQUFVLEdBQUcsWUFBWSxDQUFDO0FBRTFCLHlDQUFPLEdBQUcsU0FBUyxDQUFDO0FBRXBCLG9EQUFrQixHQUFHLENBQUMsaUNBQWlDLENBQUMsVUFBVSxFQUFFLGlDQUFpQyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBRS9HLHFEQUFtQixHQUFHLENBQUMsaUNBQWlDLENBQUMsVUFBVSxDQUFDLENBQUM7QUFFckUsbURBQWlCLEdBQUc7SUFDMUMsWUFBWSxFQUFFLElBQUksTUFBTSxDQUFDLCtCQUErQixDQUFDO0NBQzFELENBQUM7O1lBbEJILFVBQVU7Ozs7Ozs7SUFRVCw2Q0FBa0Q7Ozs7O0lBRWxELDBDQUE0Qzs7Ozs7SUFFNUMscURBQXVJOzs7OztJQUV2SSxzREFBNkY7Ozs7O0lBRTdGLG9EQUVFOzs7OztJQUdGLGtFQUE0QyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgwqkgMjAxNyBMdWthcyBSb3NlbnRoYWxlciwgQmVuamFtaW4gR2VlciwgSXZhbiBTdWJvdGljLFxuICogVG9iaWFzIFNjaHdlaXplciwgQW5kcsOpIEtpbGNoZW5tYW5uLCBhbmQgU2VwaWRlaCBBbGFzc2kuXG4gKlxuICogVGhpcyBmaWxlIGlzIHBhcnQgb2YgSkROQ29udmVydGlibGVDYWxlbmRhckRhdGVBZGFwdGVyLlxuICpcbiAqIEpETkNvbnZlcnRpYmxlQ2FsZW5kYXJEYXRlQWRhcHRlciBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG4gKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWRcbiAqIGJ5IHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4gKiAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuICpcbiAqIEpETkNvbnZlcnRpYmxlQ2FsZW5kYXJEYXRlQWRhcHRlciBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2ZcbiAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbiAqIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWNcbiAqIExpY2Vuc2UgYWxvbmcgd2l0aCBKRE5Db252ZXJ0aWJsZUNhbGVuZGFyRGF0ZUFkYXB0ZXIuICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKi9cblxuaW1wb3J0IHtJbmplY3RhYmxlfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7RGF0ZUFkYXB0ZXJ9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsJztcbmltcG9ydCB7XG4gIENhbGVuZGFyRGF0ZSxcbiAgQ2FsZW5kYXJQZXJpb2QsXG4gIEdyZWdvcmlhbkNhbGVuZGFyRGF0ZSxcbiAgSkROQ29udmVydGlibGVDYWxlbmRhcixcbiAgSkROQ29udmVydGlibGVDb252ZXJzaW9uTW9kdWxlLFxuICBKRE5QZXJpb2QsXG4gIEp1bGlhbkNhbGVuZGFyRGF0ZVxufSBmcm9tICdqZG5jb252ZXJ0aWJsZWNhbGVuZGFyJztcblxuXG5ASW5qZWN0YWJsZSgpXG4vKipcbiAqIEltcGxlbWVudHMgYERhdGVBZGFwdGVyYCBmb3IgYEpETkNvbnZlcnRpYmxlQ2FsZW5kYXJgLlxuICpcbiAqIGBKRE5Db252ZXJ0aWJsZUNhbGVuZGFyYCBzdXBwb3J0cyBwZXJpb2RzIChkYXRlcyB3aXRoIGRpZmZlcmVudCBwcmVjaXNpb25zKSwgYnV0IGhlcmUgb25seSBleGFjdCBkYXlzIGFyZSBzdXBwb3J0ZWQgZm9yIG5vdy5cbiAqL1xuZXhwb3J0IGNsYXNzIEpETkNvbnZlcnRpYmxlQ2FsZW5kYXJEYXRlQWRhcHRlciBleHRlbmRzIERhdGVBZGFwdGVyPEpETkNvbnZlcnRpYmxlQ2FsZW5kYXI+IHtcblxuICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBERF9NTV9ZWVlZID0gJ0RELU1NLVlZWVknO1xuXG4gIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IE1NX1lZWVkgPSAnTU0tWVlZWSc7XG5cbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgZGlzcGxheURhdGVGb3JtYXRzID0gW0pETkNvbnZlcnRpYmxlQ2FsZW5kYXJEYXRlQWRhcHRlci5ERF9NTV9ZWVlZLCBKRE5Db252ZXJ0aWJsZUNhbGVuZGFyRGF0ZUFkYXB0ZXIuTU1fWVlZWV07XG5cbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgcGFyc2FibGVEYXRlRm9ybWF0cyA9IFtKRE5Db252ZXJ0aWJsZUNhbGVuZGFyRGF0ZUFkYXB0ZXIuRERfTU1fWVlZWV07XG5cbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgZGF0ZUZvcm1hdFJlZ2V4ZXMgPSB7XG4gICAgJ0RELU1NLVlZWVknOiBuZXcgUmVnRXhwKCdeKFxcXFxkP1xcXFxkKS0oXFxcXGQ/XFxcXGQpLShcXFxcZHs0fSknKVxuICB9O1xuXG4gIC8vIHRoZSBjdXJyZW50bHkgYWN0aXZlIGNhbGVuZGFyIGZvcm1hdFxuICBwcml2YXRlIF9hY3RpdmVDYWxlbmRhckZvcm1hdCA9ICdHcmVnb3JpYW4nO1xuXG4gIGdldCBhY3RpdmVDYWxlbmRhckZvcm1hdCgpIHtcbiAgICByZXR1cm4gdGhpcy5fYWN0aXZlQ2FsZW5kYXJGb3JtYXQ7XG4gIH1cblxuICAvKipcbiAgICogQWRkcyBsZWFkaW5nIHplcm9zIHRvIGEgZ2l2ZW4gbnVtYmVyIGFuZCByZXR1cm5zIHRoZSByZXN1bHRpbmcgc3RyaW5nLlxuICAgKlxuICAgKiBAcGFyYW0gbnVtIHRoZSBnaXZlbiBudW1iZXIuXG4gICAqIEBwYXJhbSBkaWdpdHMgdGhlIG51bWJlciBvZiBleHBlY3RlZCBkaWdpdHMuXG4gICAqIEByZXR1cm5zIHN0cmluZyBjb250YWluaW5nIGxlYWRpbmcgemVyb3MuXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBhZGRMZWFkaW5nWmVyb1RvTnVtYmVyKG51bTogbnVtYmVyLCBkaWdpdHM6IG51bWJlcik6IHN0cmluZyB7XG5cbiAgICBjb25zdCBtaXNzaW5nRGlnaXRzID0gZGlnaXRzIC0gU3RyaW5nKG51bSkubGVuZ3RoO1xuXG4gICAgaWYgKG1pc3NpbmdEaWdpdHMgPiAwKSB7XG4gICAgICBsZXQgbGVhZGluZ1plcm9zID0gJyc7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG1pc3NpbmdEaWdpdHM7IGkrKykge1xuICAgICAgICBsZWFkaW5nWmVyb3MgKz0gJzAnO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gYCR7bGVhZGluZ1plcm9zfSR7bnVtfWA7XG5cbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIFN0cmluZyhudW0pO1xuICAgIH1cblxuICB9XG5cbiAgLyoqXG4gICAqIENvbnZlcnRzIHRoZSBnaXZlbiBkYXRlIHRvIHRoZSBpbmRpY2F0ZWQgY2FsZW5kYXIgZm9ybWF0LlxuICAgKlxuICAgKiBAcGFyYW0gZGF0ZSB0aGUgZGF0ZSB0byBiZSBjb252ZXJ0ZWQuXG4gICAqIEBwYXJhbSBmb3JtYXQgdGhlIGNhbGVuZGFyIGZvcm1hdCB0byBjb252ZXJ0IHRvLlxuICAgKiBAcmV0dXJucyBjb252ZXJ0ZWQgZGF0ZS5cbiAgICovXG4gIGNvbnZlcnRDYWxlbmRhckZvcm1hdChkYXRlOiBKRE5Db252ZXJ0aWJsZUNhbGVuZGFyLCBmb3JtYXQ6IHN0cmluZyk6IEpETkNvbnZlcnRpYmxlQ2FsZW5kYXIge1xuXG4gICAgLy8gYW5vdGhlciBpbnN0YW5jZSBoYXMgdG8gYmUgcmV0dXJuZWQsIG90aGVyd2lzZSBcImFjdGl2ZURhdGVcIiBzZXQgbWV0aG9kIGlzIG5vdCB0cmlnZ2VyZWQgZm9yIE1hdFllYXJWaWV3XG5cbiAgICBjb25zdCBkYXRlTW9kID0gdGhpcy5jbG9uZShkYXRlKTtcblxuICAgIHN3aXRjaCAoZm9ybWF0KSB7XG4gICAgICBjYXNlICdHcmVnb3JpYW4nOlxuICAgICAgICB0aGlzLl9hY3RpdmVDYWxlbmRhckZvcm1hdCA9ICdHcmVnb3JpYW4nO1xuICAgICAgICByZXR1cm4gZGF0ZU1vZC5jb252ZXJ0Q2FsZW5kYXIoJ0dyZWdvcmlhbicpO1xuXG4gICAgICBjYXNlICdKdWxpYW4nOlxuICAgICAgICB0aGlzLl9hY3RpdmVDYWxlbmRhckZvcm1hdCA9ICdKdWxpYW4nO1xuICAgICAgICByZXR1cm4gZGF0ZU1vZC5jb252ZXJ0Q2FsZW5kYXIoJ0p1bGlhbicpO1xuXG4gICAgICBkZWZhdWx0OlxuICAgICAgICAvLyBpbnZhbGlkIGZvcm1hdFxuICAgICAgICByZXR1cm4gZGF0ZU1vZDtcbiAgICB9XG4gIH1cblxuICBnZXRZZWFyKGRhdGU6IEpETkNvbnZlcnRpYmxlQ2FsZW5kYXIpOiBudW1iZXIge1xuICAgIHJldHVybiBkYXRlLnRvQ2FsZW5kYXJQZXJpb2QoKS5wZXJpb2RTdGFydC55ZWFyO1xuICB9XG5cbiAgZ2V0TW9udGgoZGF0ZTogSkROQ29udmVydGlibGVDYWxlbmRhcik6IG51bWJlciB7XG4gICAgLy8gcmV0dXJuIDAgaW5kZXggYmFzZWQgbW9udGhcbiAgICByZXR1cm4gZGF0ZS50b0NhbGVuZGFyUGVyaW9kKCkucGVyaW9kU3RhcnQubW9udGggLSAxO1xuICB9XG5cbiAgZ2V0RGF0ZShkYXRlOiBKRE5Db252ZXJ0aWJsZUNhbGVuZGFyKTogbnVtYmVyIHtcbiAgICByZXR1cm4gZGF0ZS50b0NhbGVuZGFyUGVyaW9kKCkucGVyaW9kU3RhcnQuZGF5O1xuICB9XG5cbiAgZ2V0RGF5T2ZXZWVrKGRhdGU6IEpETkNvbnZlcnRpYmxlQ2FsZW5kYXIpOiBudW1iZXIge1xuXG4gICAgLy8gZGF5T2ZXZWVrIGlzIGFuIG9wdGlvbmFsIGNsYXNzIG1lbWJlciwgYnV0IGFsd2F5cyBzZXQgd2hlbiByZXR1cm5lZCBieSB0aGlzIG1ldGhvZFxuICAgIGNvbnN0IGRheU9mV2VlazogbnVtYmVyIHwgdW5kZWZpbmVkID0gZGF0ZS50b0NhbGVuZGFyUGVyaW9kKCkucGVyaW9kU3RhcnQuZGF5T2ZXZWVrO1xuXG4gICAgaWYgKGRheU9mV2VlayAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gZGF5T2ZXZWVrO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ2RheSBvZiB3ZWVrIGlzIG5vdCBzZXQgYWx0aG91Z2ggaXQgc2hvdWxkIGJlJyk7XG4gICAgfVxuXG4gIH1cblxuICBnZXRNb250aE5hbWVzKHN0eWxlOiAnbG9uZycgfCAnc2hvcnQnIHwgJ25hcnJvdycpOiBzdHJpbmdbXSB7XG4gICAgLy8gVE9ETzogaW1wbGVtZW50IHRoaXMgcHJvcGVybHksIHRha2luZyBjYWxlbmRhciBmb3JtYXQgYW5kIGxvY2FsZSBpbnRvIGFjY291bnRcbiAgICByZXR1cm4gWydKYW4nLCAnRmViJywgJ01hcicsICdBcHInLCAnTWF5JywgJ0p1bmUnLCAnSnVseScsICdBdWcnLCAnU2VwdCcsICdPY3QnLCAnTm92JywgJ0RlYyddO1xuICB9XG5cbiAgZ2V0RGF0ZU5hbWVzKCk6IHN0cmluZ1tdIHtcbiAgICAvLyBUT0RPOiBpbXBsZW1lbnQgdGhpcyBwcm9wZXJseSwgdGFraW5nIGNhbGVuZGFyIGZvcm1hdCBhbmQgbG9jYWxlIGludG8gYWNjb3VudFxuICAgIGNvbnN0IGRhdGVOYW1lczogc3RyaW5nW10gPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMTsgaSA8PSAzMTsgaSsrKSB7XG4gICAgICBkYXRlTmFtZXMucHVzaChTdHJpbmcoaSkpO1xuICAgIH1cblxuICAgIHJldHVybiBkYXRlTmFtZXM7XG4gIH1cblxuICBnZXREYXlPZldlZWtOYW1lcyhzdHlsZTogJ2xvbmcnIHwgJ3Nob3J0JyB8ICduYXJyb3cnKSB7XG4gICAgLy8gVE9ETzogaW1wbGVtZW50IHRoaXMgcHJvcGVybHksIHRha2luZyBjYWxlbmRhciBmb3JtYXQgYW5kIGxvY2FsZSBpbnRvIGFjY291bnRcbiAgICByZXR1cm4gWydTdW4nLCAnTW9uJywgJ1R1ZScsICdXZWQnLCAnVGh1cicsICdGcmknLCAnU2F0J107XG4gIH1cblxuICBnZXRZZWFyTmFtZShkYXRlOiBKRE5Db252ZXJ0aWJsZUNhbGVuZGFyKTogc3RyaW5nIHtcbiAgICByZXR1cm4gU3RyaW5nKGRhdGUudG9DYWxlbmRhclBlcmlvZCgpLnBlcmlvZFN0YXJ0LnllYXIpO1xuICB9XG5cbiAgZ2V0Rmlyc3REYXlPZldlZWsoKTogbnVtYmVyIHtcbiAgICAvLyBUT0RPOiBpbXBsZW1lbnQgdGhpcyBwcm9wZXJseSwgdGFraW5nIGNhbGVuZGFyIGZvcm1hdCBpbnRvIGFjY291bnRcbiAgICByZXR1cm4gMDtcbiAgfVxuXG4gIGdldE51bURheXNJbk1vbnRoKGRhdGU6IEpETkNvbnZlcnRpYmxlQ2FsZW5kYXIpOiBudW1iZXIge1xuICAgIGNvbnN0IGNhbGVuZGFyUGVyaW9kID0gZGF0ZS50b0NhbGVuZGFyUGVyaW9kKCk7XG5cbiAgICByZXR1cm4gZGF0ZS5kYXlzSW5Nb250aChjYWxlbmRhclBlcmlvZC5wZXJpb2RTdGFydCk7XG4gIH1cblxuICBjbG9uZShkYXRlOiBKRE5Db252ZXJ0aWJsZUNhbGVuZGFyKTogSkROQ29udmVydGlibGVDYWxlbmRhciB7XG5cbiAgICBjb25zdCBqZG5QZXJpb2QgPSBkYXRlLnRvSkROUGVyaW9kKCk7XG5cbiAgICBzd2l0Y2ggKHRoaXMuX2FjdGl2ZUNhbGVuZGFyRm9ybWF0KSB7XG4gICAgICBjYXNlICdHcmVnb3JpYW4nOlxuICAgICAgICByZXR1cm4gbmV3IEdyZWdvcmlhbkNhbGVuZGFyRGF0ZShqZG5QZXJpb2QpO1xuXG4gICAgICBjYXNlICdKdWxpYW4nOlxuICAgICAgICByZXR1cm4gbmV3IEp1bGlhbkNhbGVuZGFyRGF0ZShqZG5QZXJpb2QpO1xuICAgIH1cblxuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBkYXRlIGluIHRoZSBzcGVjaWZpZWQgY2FsZW5kYXIgZm9ybWF0LlxuICAgKlxuICAgKiBAcGFyYW0geWVhciB0aGUgZGF0ZSdzIHllYXIuXG4gICAqIEBwYXJhbSBtb250aCB0aGUgZGF0ZSdzIG1vbnRoICgwLWJhc2VkIGluZGV4KS5cbiAgICogQHBhcmFtIGRhdGUgdGhlIGRhdGUncyBkYXkuXG4gICAqIEBwYXJhbSBjYWxlbmRhciB0aGUgY2FsZW5kYXIgZm9ybWF0IHRvIGJlIHVzZWQuXG4gICAqIEByZXR1cm5zIGEgZGF0ZSBpbiB0aGUgc3BlY2lmaWVkIGNhbGVuZGFyIGZvcm1hdC5cbiAgICovXG4gIHByaXZhdGUgY3JlYXRlQ2FsZW5kYXJEYXRlKHllYXI6IG51bWJlciwgbW9udGg6IG51bWJlciwgZGF0ZTogbnVtYmVyLCBjYWxlbmRhcjogc3RyaW5nKTogSkROQ29udmVydGlibGVDYWxlbmRhciB7XG4gICAgLy8gbW9udGggcGFyYW0gaXMgMCBpbmRleGVkLCBidXQgd2UgdXNlIDEgYmFzZWQgaW5kZXggZm9yIG1vbnRoc1xuICAgIGNvbnN0IGNhbERhdGUgPSBuZXcgQ2FsZW5kYXJEYXRlKHllYXIsIG1vbnRoICsgMSwgZGF0ZSk7XG5cbiAgICBzd2l0Y2ggKGNhbGVuZGFyKSB7XG4gICAgICBjYXNlICdHcmVnb3JpYW4nOlxuICAgICAgICByZXR1cm4gbmV3IEdyZWdvcmlhbkNhbGVuZGFyRGF0ZShuZXcgQ2FsZW5kYXJQZXJpb2QoY2FsRGF0ZSwgY2FsRGF0ZSkpO1xuXG4gICAgICBjYXNlICdKdWxpYW4nOlxuICAgICAgICByZXR1cm4gbmV3IEp1bGlhbkNhbGVuZGFyRGF0ZShuZXcgQ2FsZW5kYXJQZXJpb2QoY2FsRGF0ZSwgY2FsRGF0ZSkpO1xuICAgIH1cbiAgfVxuXG4gIGNyZWF0ZURhdGUoeWVhcjogbnVtYmVyLCBtb250aDogbnVtYmVyLCBkYXRlOiBudW1iZXIpOiBKRE5Db252ZXJ0aWJsZUNhbGVuZGFyIHtcblxuICAgIC8vIGNyZWF0ZSBhIGRhdGUgaW4gdGhlIGFjdGl2ZSBjYWxlbmRhciBmb3JtYXRcbiAgICByZXR1cm4gdGhpcy5jcmVhdGVDYWxlbmRhckRhdGUoeWVhciwgbW9udGgsIGRhdGUsIHRoaXMuX2FjdGl2ZUNhbGVuZGFyRm9ybWF0KTtcblxuICB9XG5cbiAgdG9kYXkoKTogSkROQ29udmVydGlibGVDYWxlbmRhciB7XG5cbiAgICAvLyBnZXQgdG9kYXkncyBkYXRlIGZyb20gdGhlIG5hdGl2ZSBKUyBEYXRlIG9iamVjdFxuICAgIGNvbnN0IHRvZGF5OiBEYXRlID0gbmV3IERhdGUoKTtcblxuICAgIGNvbnN0IHllYXIgPSB0b2RheS5nZXRGdWxsWWVhcigpO1xuXG4gICAgLy8gMCBiYXNlZCBtb250aFxuICAgIGNvbnN0IG1vbnRoID0gdG9kYXkuZ2V0TW9udGgoKTtcblxuICAgIC8vIGRheSBvZiBtb250aCwgMSBiYXNlZCBpbmRleFxuICAgIGNvbnN0IGRheSA9IHRvZGF5LmdldERhdGUoKTtcblxuICAgIC8vIGNyZWF0ZSBhIEdyZWdvcmlhbiBjYWxlbmRhciBkYXRlIGZyb20gdGhlIG5hdGl2ZSBKUyBvYmplY3RcbiAgICAvLyBtb250aCB1c2VkIGEgMSBiYXNlZCBpbmRleFxuICAgIGNvbnN0IGNhbERhdGUgPSBuZXcgQ2FsZW5kYXJEYXRlKHllYXIsIG1vbnRoICsgMSwgZGF5KTtcblxuICAgIGNvbnN0IGRhdGVHcmVnb3JpYW4gPSBuZXcgR3JlZ29yaWFuQ2FsZW5kYXJEYXRlKG5ldyBDYWxlbmRhclBlcmlvZChjYWxEYXRlLCBjYWxEYXRlKSk7XG5cbiAgICAvLyBjb252ZXJ0IHRoZSBkYXRlIHRvIHRoZSBhY3RpdmUgY2FsZW5kYXIgZm9ybWF0XG4gICAgY29uc3QgZGF0ZTogSkROQ29udmVydGlibGVDYWxlbmRhciA9IHRoaXMuY29udmVydENhbGVuZGFyRm9ybWF0KGRhdGVHcmVnb3JpYW4sIHRoaXMuX2FjdGl2ZUNhbGVuZGFyRm9ybWF0KTtcblxuICAgIHJldHVybiBkYXRlO1xuXG4gIH1cblxuICBwYXJzZSh2YWx1ZTogYW55LCBwYXJzZUZvcm1hdDogYW55KTogSkROQ29udmVydGlibGVDYWxlbmRhciB8IG51bGwge1xuXG4gICAgbGV0IGRhdGU7XG4gICAgaWYgKHBhcnNlRm9ybWF0ICE9PSB1bmRlZmluZWQgJiYgdHlwZW9mIHBhcnNlRm9ybWF0ID09PSAnc3RyaW5nJyAmJiBKRE5Db252ZXJ0aWJsZUNhbGVuZGFyRGF0ZUFkYXB0ZXIucGFyc2FibGVEYXRlRm9ybWF0cy5pbmRleE9mKHBhcnNlRm9ybWF0KSAhPT0gLTEpIHtcblxuICAgICAgc3dpdGNoIChwYXJzZUZvcm1hdCkge1xuICAgICAgICBjYXNlIEpETkNvbnZlcnRpYmxlQ2FsZW5kYXJEYXRlQWRhcHRlci5ERF9NTV9ZWVlZOiB7XG5cbiAgICAgICAgICBjb25zdCBkYXRlU3RyaW5nUmVnZXggPSBKRE5Db252ZXJ0aWJsZUNhbGVuZGFyRGF0ZUFkYXB0ZXIuZGF0ZUZvcm1hdFJlZ2V4ZXNbcGFyc2VGb3JtYXRdO1xuXG4gICAgICAgICAgY29uc3QgcGFyc2VkOiBBcnJheTxhbnk+IHwgbnVsbCA9IGRhdGVTdHJpbmdSZWdleC5leGVjKHZhbHVlKTtcblxuICAgICAgICAgIGlmIChwYXJzZWQgIT09IG51bGwpIHtcblxuICAgICAgICAgICAgLy8gaW5kZXggMCBpcyB0aGUgd2hvbGUgbWF0Y2hcblxuICAgICAgICAgICAgLy8gbW9udGggaW5kZXggbXVzdCBiZSAwIGJhc2VkXG4gICAgICAgICAgICBkYXRlID0gdGhpcy5jcmVhdGVEYXRlKHBhcnNlSW50KHBhcnNlZFszXSksIHBhcnNlSW50KHBhcnNlZFsyXSkgLSAxLCBwYXJzZUludChwYXJzZWRbMV0pKTtcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBFcnJvcjogcGFyc2luZyBvZiBkYXRlIHN0cmluZyBmYWlsZWQ6ICR7dmFsdWV9YCk7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGBFcnJvcjogc3VwcG9ydGVkIHBhcnNhYmxlIGZvcm1hdCB3YXMgbm90IGhhbmRsZWQgY29ycmVjdGx5OiAke3BhcnNlRm9ybWF0fWApO1xuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICB9XG5cblxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmxvZyhgRXJyb3I6IHVua25vd24gcGFyc2VGb3JtYXQgJHtwYXJzZUZvcm1hdH1gKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHJldHVybiBkYXRlO1xuICB9XG5cbiAgZm9ybWF0KGRhdGU6IEpETkNvbnZlcnRpYmxlQ2FsZW5kYXIsIGRpc3BsYXlGb3JtYXQ6IGFueSk6IHN0cmluZyB7XG4gICAgbGV0IGRhdGVTdHJpbmcgPSAnJztcbiAgICBpZiAoZGlzcGxheUZvcm1hdCAhPT0gdW5kZWZpbmVkICYmIHR5cGVvZiBkaXNwbGF5Rm9ybWF0ID09PSAnc3RyaW5nJyAmJiBKRE5Db252ZXJ0aWJsZUNhbGVuZGFyRGF0ZUFkYXB0ZXIuZGlzcGxheURhdGVGb3JtYXRzLmxhc3RJbmRleE9mKGRpc3BsYXlGb3JtYXQpICE9PSAtMSkge1xuXG4gICAgICBjb25zdCBjYWxlbmRhclBlcmlvZCA9IGRhdGUudG9DYWxlbmRhclBlcmlvZCgpO1xuXG4gICAgICBzd2l0Y2ggKGRpc3BsYXlGb3JtYXQpIHtcblxuICAgICAgICBjYXNlIEpETkNvbnZlcnRpYmxlQ2FsZW5kYXJEYXRlQWRhcHRlci5ERF9NTV9ZWVlZOiB7XG5cbiAgICAgICAgICBkYXRlU3RyaW5nID1cbiAgICAgICAgICAgIGAke0pETkNvbnZlcnRpYmxlQ2FsZW5kYXJEYXRlQWRhcHRlci5hZGRMZWFkaW5nWmVyb1RvTnVtYmVyKGNhbGVuZGFyUGVyaW9kLnBlcmlvZFN0YXJ0LmRheSwgMil9LSR7SkROQ29udmVydGlibGVDYWxlbmRhckRhdGVBZGFwdGVyLmFkZExlYWRpbmdaZXJvVG9OdW1iZXIoY2FsZW5kYXJQZXJpb2QucGVyaW9kU3RhcnQubW9udGgsIDIpfS0ke0pETkNvbnZlcnRpYmxlQ2FsZW5kYXJEYXRlQWRhcHRlci5hZGRMZWFkaW5nWmVyb1RvTnVtYmVyKGNhbGVuZGFyUGVyaW9kLnBlcmlvZFN0YXJ0LnllYXIsIDQpfWA7XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGNhc2UgSkROQ29udmVydGlibGVDYWxlbmRhckRhdGVBZGFwdGVyLk1NX1lZWVk6IHtcbiAgICAgICAgICBkYXRlU3RyaW5nID0gYCR7SkROQ29udmVydGlibGVDYWxlbmRhckRhdGVBZGFwdGVyLmFkZExlYWRpbmdaZXJvVG9OdW1iZXIoY2FsZW5kYXJQZXJpb2QucGVyaW9kU3RhcnQubW9udGgsIDIpfS0ke0pETkNvbnZlcnRpYmxlQ2FsZW5kYXJEYXRlQWRhcHRlci5hZGRMZWFkaW5nWmVyb1RvTnVtYmVyKGNhbGVuZGFyUGVyaW9kLnBlcmlvZFN0YXJ0LnllYXIsIDQpfWA7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgY29uc29sZS5sb2coYEVycm9yOiBzdXBwb3J0ZWQgZGlzcGxheSBmb3JtYXQgd2FzIG5vdCBoYW5kbGVkIGNvcnJlY3RseTogJHtkaXNwbGF5Rm9ybWF0fWApO1xuICAgICAgICB9XG5cbiAgICAgIH1cblxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmxvZyhgRXJyb3I6IHVua25vd24gZGlzcGxheUZvcm1hdCAke2Rpc3BsYXlGb3JtYXR9YCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGRhdGVTdHJpbmc7XG4gIH1cblxuICBhZGRDYWxlbmRhclllYXJzKGRhdGU6IEpETkNvbnZlcnRpYmxlQ2FsZW5kYXIsIHllYXJzOiBudW1iZXIpOiBKRE5Db252ZXJ0aWJsZUNhbGVuZGFyIHtcblxuICAgIC8vIGFub3RoZXIgaW5zdGFuY2UgaGFzIHRvIGJlIHJldHVybmVkLCBvdGhlcndpc2UgXCJhY3RpdmVEYXRlXCIgc2V0IG1ldGhvZCBpcyBub3QgdHJpZ2dlcmVkIGZvciBNYXRZZWFyVmlld1xuXG4gICAgY29uc3QgZGF0ZU1vZCA9IHRoaXMuY2xvbmUoZGF0ZSk7XG5cbiAgICBkYXRlTW9kLnRyYW5zcG9zZVBlcmlvZEJ5WWVhcih5ZWFycyk7XG5cbiAgICByZXR1cm4gZGF0ZU1vZDtcblxuICB9XG5cbiAgYWRkQ2FsZW5kYXJNb250aHMoZGF0ZTogSkROQ29udmVydGlibGVDYWxlbmRhciwgbW9udGhzOiBudW1iZXIpOiBKRE5Db252ZXJ0aWJsZUNhbGVuZGFyIHtcblxuICAgIC8vIGFub3RoZXIgaW5zdGFuY2UgaGFzIHRvIGJlIHJldHVybmVkLCBvdGhlcndpc2UgXCJhY3RpdmVEYXRlXCIgc2V0IG1ldGhvZCBpcyBub3QgdHJpZ2dlcmVkIGZvciBNYXRNb250aFZpZXdcblxuICAgIGNvbnN0IGRhdGVNb2QgPSB0aGlzLmNsb25lKGRhdGUpO1xuXG4gICAgZGF0ZU1vZC50cmFuc3Bvc2VQZXJpb2RCeU1vbnRoKG1vbnRocyk7XG5cbiAgICByZXR1cm4gZGF0ZU1vZDtcbiAgfVxuXG4gIGFkZENhbGVuZGFyRGF5cyhkYXRlOiBKRE5Db252ZXJ0aWJsZUNhbGVuZGFyLCBkYXlzOiBudW1iZXIpOiBKRE5Db252ZXJ0aWJsZUNhbGVuZGFyIHtcblxuICAgIC8vIGFub3RoZXIgaW5zdGFuY2UgaGFzIHRvIGJlIHJldHVybmVkLCBvdGhlcndpc2UgZXZlbnRzIGRvIG5vdCB3b3JrIGNvcnJlY3RseVxuXG4gICAgY29uc3QgZGF0ZU1vZCA9IHRoaXMuY2xvbmUoZGF0ZSk7XG5cbiAgICBkYXRlTW9kLnRyYW5zcG9zZVBlcmlvZEJ5RGF5KGRheXMpO1xuXG4gICAgcmV0dXJuIGRhdGVNb2Q7XG4gIH1cblxuICB0b0lzbzg2MDEoZGF0ZTogSkROQ29udmVydGlibGVDYWxlbmRhcikge1xuXG4gICAgLy8gdXNlIEdyZWdvcmlhblxuICAgIGNvbnN0IGdyZWdvcmlhbkNhbCA9IGRhdGUuY29udmVydENhbGVuZGFyKCdHcmVnb3JpYW4nKTtcblxuICAgIGNvbnN0IGdyZWdvcmlhbkNhbFBlcmlvZCA9IGdyZWdvcmlhbkNhbC50b0NhbGVuZGFyUGVyaW9kKCk7XG5cbiAgICBjb25zb2xlLmxvZygndG8gaXNvJyk7XG5cbiAgICByZXR1cm4gYCR7SkROQ29udmVydGlibGVDYWxlbmRhckRhdGVBZGFwdGVyLmFkZExlYWRpbmdaZXJvVG9OdW1iZXIoZ3JlZ29yaWFuQ2FsUGVyaW9kLnBlcmlvZFN0YXJ0LnllYXIsIDQpfS0ke0pETkNvbnZlcnRpYmxlQ2FsZW5kYXJEYXRlQWRhcHRlci5hZGRMZWFkaW5nWmVyb1RvTnVtYmVyKGdyZWdvcmlhbkNhbFBlcmlvZC5wZXJpb2RTdGFydC5tb250aCwgMil9LSR7SkROQ29udmVydGlibGVDYWxlbmRhckRhdGVBZGFwdGVyLmFkZExlYWRpbmdaZXJvVG9OdW1iZXIoZ3JlZ29yaWFuQ2FsUGVyaW9kLnBlcmlvZFN0YXJ0LmRheSwgMil9YDtcblxuICB9XG5cblxuICBpc0RhdGVJbnN0YW5jZShvYmo6IGFueSk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAob2JqIGluc3RhbmNlb2YgSkROQ29udmVydGlibGVDYWxlbmRhcik7XG4gIH1cblxuICBpc1ZhbGlkKGRhdGU6IEpETkNvbnZlcnRpYmxlQ2FsZW5kYXIpOiBib29sZWFuIHtcbiAgICAvLyBUT0RPOiBpbXBsZW1lbnQgdGhpcyBwcm9wZXJseVxuXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBpbnZhbGlkKCk6IEpETkNvbnZlcnRpYmxlQ2FsZW5kYXIge1xuICAgIC8vIFRPRE86IGNyZWF0ZSBhbiBpbnZhbGlkIGluc3RhbmNlPyBGb3IgdGVzdGluZz9cblxuICAgIHJldHVybiB0aGlzLnRvZGF5KCk7XG4gIH1cblxuXG59XG4iXX0=